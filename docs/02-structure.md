# Directory Structure & Functionalities

All WordPress `filters` & `actions` are registered in class's
`register` method. All classes that has logic to be hooked to
WordPress should be added to `$service` property in `src/Plugin.php` file.

`src/Plugin.php` is the starting point for everything.

## The `root` directory

The `plugin.php` file is for WordPress to register the plugin.

The `resources` directory is for any static files that are required by
the plugin.

## The `src` directory

The `src` directories are structured and named to follow PSR-4 autoloading
standard.

The `Plugin.php` file is starting point for bootstrapping the plugin's logic and
registering logic to WordPress via hooks.

The `Electro.php` file contains mainly logic for translations. (Note: previously 
it has had more logic but has been refactored and translations could be refactored 
to it's own class.)  

The `helpers.php` file contains global functions behind `Electro` namespace.
Helper functions are meant to use in theme's UI logic so that it won't be
necessary to use classes directly.  

### Actions

The `Actions` folder contains logic that can be called via WordPress 
`do_action` function. These can be called outside of this plugin without direct
class use.

Methods in `Actions` can be dispatched by calling WordPress 
`do_action($namespace/$method)` function.

Action classes contains a `$name` property which is a namespace for `do_action`. 
Action classes public methods are exposed to be called via `do_action`. If
Action class contains public method called `handle` it is used by default for 
namespaced action for example `do_action('elector/log')` => `Log->handle()` is 
called. And for `do_action('elector/notice/info')` => `Notice->info()` is called. 

Registered actions are listed in `src/Actions/Actions.php` file.

### Admin

The `Admin` folder contains logic for WordPress admin. It also contains
Advanced Custom Field's field registrations.

The `src/Admin/Admin.php` contains all registered admin hooks.

#### ACF

The ACF is in `Admin` folder due historic reason but the logic is used
in non-admin side as well. 

**IMPORTANT NOTICE:** Unique ACF key are generated by using full class
path and changing the folder structure would break the current fields data 
mapping.

#### Actions

The `Actions` in `Admin` folder contains logic for admin routes. Admin actions
are excetued via `do_action('admin_post_{action_id}')`. 

When calling `{admin_url}/admin-post.php?action=action_id the corresponding 
admin action is exectued

**Note:** Not to be confused with `src/Actions`.

#### Other

Other directories are grouped by their functionality type.

#### views

The `views` directory contains UI templates for displaying data in admin.

### CLI

The `CLI` directory contains custom `wp-cli` commands. The commands are registered
using `wp-cli`'s class style registration. See more: [https://make.wordpress.org/cli/handbook/commands-cookbook/#required-registration-arguments](https://make.wordpress.org/cli/handbook/commands-cookbook/#required-registration-arguments).

Commands are registered via `src/CLI/Console.php` file. Command classes contains 
a `$command` property which includes a root namespace and the command namespace.

#### Commands

**Products**

Currently supported commands:

`wp electro products sync` - Fetches all products from EnerimCIS API and imports
them to WordPress as custom post type. It also purges all items from WordPress
that are not in the API response.

`wp electro products import {ID}` - Fetches specific product from EnerimCIS API
by `product_name` property.

`wp electro products delete {ID}` - Delete specific product by title from
WordPress.

Run `wp electro products --help` to see more examples.

### Company

Logic for getting company data. Used in `Http/Rest/CompanyController`.
Reads postcodes from csv in `resources` directory.

### EnerimCIS

### Http

Logic for HTTP controllers. Currently used only for WP REST API.

### Models

WordPress custom post types.

### Money

Logic for handling prices. Prices can be in full unit (â‚¬) or in subunit (cent).

Used in `Product/ProductPrice` class.

### Presenters

Logic is formatted and exposed to UI via `Presenters` classes. The Presenters
are entry point for the UI, all data should be passed via these classes.

Presenters should return data in a array format as needed in UI.

### Product

Logic for constructing Products. 

### ProductGroup

Logic for constructing Product Groups containing Products. 

### Support

The `Support` directory contains general helper logic.

### Vat

Logic for handling vat in prices. Used in `Product/ProductPrice` class.

### WordPress

The `WordPress` directory contains WordPress related helper logic. Currently it
contains only base class for Models (= custom post type). 

Models has logic for registering custom post type in `register` method.
